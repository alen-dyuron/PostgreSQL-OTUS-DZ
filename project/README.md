# Проектная работа

## Тема

Создание и тестирование высоконагруженного отказоустойчивого кластера PostgreSQL на базе Patroni

## Цель и задачи проекта

Цель проекта: Создать высокодоступный кластер PostgreSQL, развёртывание и обслуживание которого будут автоматизированы модулями Patroni и etcd, и тестировать отказоустойчивость кластера в рамках планированного и непланированного переключения роли.

- [x] Создание виртуалной кластеризованной среды Ubuntu c распределённом хранилищем конфигурации etcd
- [ ] Настраивание модули управления Patroni
- [ ] Тестирование переключения и отказоустойчивости кластера
- [ ] ...


> [!NOTE]
> Здесь показано галочками какие задачи были выполнены


## Архитектура

### Используеммые технрлогии

Для выполнения этого проекта исползовались следующие текнологии 

| Роль                                        | Название                 | Версия                            | Коментарии               |
| ------------------------------------------- | ------------------------ | --------------------------------- | ------------------------ |
| Слой виртуализации                          | Oracle VM Virtualbox     | Версия 7.0.22 r165102 (Qt5.15.2)  |                          |
| ОЦ кластера                                 | Ubuntu                   | 24.04 LTS (серверный)             |                          |
| DCS (распределённое хранилище конфигурации) | etcd                     | 3.4.30                            | repository (precompiled) |
| Слой отказоустойчивости Postgres            | Patroni                  |                                   |                          |
| База данных                                 | Postgres                 | 18                                | repository (precompiled) |

### Сетевая топологиа

Подсети виртуальной среды былти настроены вот таким образом для выполнения этого проекта:

| Network name                     | Подсеть          | Маск          | Исползование           |
| -------------------------------- | ---------------- | ------------- | ---------------------- |
| VirtualBox Host-Only Adapter     | 192.168.56.1/24  | 255.255.255.0 | postgres кластер IPs   |
| VirtualBox Host-Only Adapter #2  | 192.168.47.1/24  | 255.255.255.0 | etcd кластер IPs       |

Виртуальные машины кластера имеют сдедующа сетевая топология:

| Название хоста          | Название DCS         | Общий IP      | Айпи етсд     | Исползование                    |
| ----------------------- | -------------------- | ------------- | ------------- | ------------------------------- | 
| ubt-pg-aduron-dbnode1   | ubt-pg-aduron-etcd1  | 192.168.56.10 | 192.168.47.10 | Мастер кластера Postgres        |
| ubt-pg-aduron-dbnode2   | ubt-pg-aduron-etcd2  | 192.168.56.20 | 192.168.47.20 | Реплиса кластера Postgres       |
| ubt-pg-aduron-cluster3  | ubt-pg-aduron-etcd3  | 192.168.56.30 | 192.168.47.30 | Допольнительный DCS-хост        |

> [!NOTE]
> Также отмечаем, что каждая машина имеет допольнительный сетеввой доступ типа NAT, который используется для их полключения к интернету.


### Диаграм архитектуры



## Выполнение проекта


### Создание виртуалной кластеризованной среды Ubuntu c распределённом хранилищем конфигурации etcd


#### Создание сетевой конфигурации

По умолчанию, Oracle VM VirtualBox предоставляет одну подсеть типа *Virtual Host Adapter* (виртуальный адаптер хоста), которая полволяет подключаться к ВМ с хоста. Однако для создания более [реалистичной архитектуры](#сетевая-топологиа), нам понадобится и одна допольнительная подсеть для управления кластером etcd. Создать её в VirtualBox можно следующим образом:

Выбрать меню *Файл / Инструменты / Менеджер Сетей*, Затем нажать кнопку *Создать*
![Network Management](img/1_vm_install/net-1.png)

Заполнить детали новой подсети таким способом:
![Network Management](img/1_vm_install/net-2.png)




### Настраивание модули управления Patroni



### Тестирование переключения и отказоустойчивости кластера




## Список использованных источников:

1.
2.
3.
4.
